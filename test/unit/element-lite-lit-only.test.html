<!doctype html>
  <html>
  <head>
    <meta charset="utf-8">
    <script src="../../../../@webcomponents/webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../../../wct-browser-legacy/browser.js"></script>
    <script src="../../../../@polymer/iron-test-helpers/mock-interactions.js"></script>
  </head>
  <body>

    <test-element-two id="test"></test-element-two>

    <script type="module">
      import { ElementLiteLitOnly, html } from '../../element-lite-lit-only.js';

      /**
       * @extends {ElementLiteLitOnly}
      */
      class TestElement extends ElementLiteLitOnly(window.HTMLElement) {
        static get is () { return 'test-element-two'; }

        constructor() {
          super();
          this._boundedButtonClicked = this._buttonClicked.bind(this);
          sinon.spy(this, '_boundedButtonClicked');
        }

        render () {
          return html`
            <style>
              #button {
                width: 500px;
              }
            </style>
            <input id="input" type="text">
            <button id="button" type="button" on-click=${this._boundedButtonClicked}>Test</button>
          `;
        }

        _buttonClicked () {
          this.shadowRoot.querySelector('#input').value = Math.random();
        }
      }

      window.customElements.define(TestElement.is, TestElement);
      window.TestElement = TestElement;
    </script>

    <script type="module">
      suite('ElementLiteLitOnly Mixin', () => {
        test('should have not be a HTMLUnknownElement constructor', () => {
          const el = document.querySelector('#test');
          expect(el.constructor.is).to.equal('test-element-two');
        });

        test('shadow root elements should exist', () => {
          const el = document.querySelector('#test');
          const input = el.shadowRoot.querySelector('#input');
          const button = el.shadowRoot.querySelector('#button');
          expect(input).to.exist;
          expect(button).to.exist;
        });

        test('button can be clicked', done => {
          const el = document.createElement('test-element-two');
          document.body.append(el);
          const button = el.shadowRoot.querySelector('#button');
          expect(button).to.exist;
          MockInteractions.tap(button);
          setTimeout(() => {
            expect(el._boundedButtonClicked.calledOnce).to.be.true;
            document.body.removeChild(el);
            done();
          });
        });

        test('button style is changed', () => {
          const el = document.createElement('test-element-two');
          document.body.append(el);
          const button = el.shadowRoot.querySelector('#button');
          expect(button).to.exist;
          expect(button.getBoundingClientRect().width).to.equal(500);
        });
      });
    </script>
  </body>
</html>