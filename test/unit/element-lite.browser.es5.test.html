<!doctype html>
  <html>
  <head>
    <meta charset="utf-8">
    <script src="../../../../@webcomponents/webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../../../@webcomponents/webcomponentsjs/custom-elements-es5-adapter.js"></script>
    <script src="../../../../wct-browser-legacy/browser.js"></script>
    <script src="../../../../@polymer/iron-test-helpers/mock-interactions.js"></script>
    <script src="./polyfills/find-index.js"></script>
  </head>
  <body>

    <test-element-three id="test"></test-element-three>

    <script src="../../dist/element-lite.umd.es5.js"></script>
    <script src="./scripts/element-lite.browser.es5.test.js"></script>

    <script>
      window.addEventListener('WebComponentsReady', function() {
        var script = document.createElement('script');
        var component = document.createElement('script');
        script.src = '../../dist/element-lite-lit-only.umd.es5.min.js';
        component.src = './scripts/element-lite-lit-only.browser.es5.test.js';
        document.head.appendChild(script);
        document.head.appendChild(component);

        setTimeout(function() {
          suite('ElementLite Mixin', function () {
            test('should have not be a HTMLUnknownElement constructor', function () {
              const el = document.querySelector('#test');
              expect(el.constructor.is).to.equal('test-element-three');
            });

            test('shadow root elements should exist', function () {
              const el = document.querySelector('#test');
              const span = el.shadowRoot.querySelector('#span');
              const span2 = el.shadowRoot.querySelector('#span-two');
              const button = el.shadowRoot.querySelector('#button');
              expect(span).to.exist;
              expect(span2).to.exist;
              expect(button).to.exist;
            });

            test('shadowRoot changes when props changed', function (done) {
              const el = document.createElement('test-element-three');
              document.body.append(el);
              el.prop1 = 'a';
              el.set('prop2.attr1', 'b');
              setTimeout(function () {
                expect(el.shadowRoot.querySelector('#span').textContent.trim()).to.equal('a')
                expect(el.shadowRoot.querySelector('#span-two').textContent.trim()).to.equal('b')
                document.body.removeChild(el);
                done();
              });
            });

            test('button can be clicked', function (done) {
              const el = document.createElement('test-element-three');
              document.body.append(el);
              const button = el.shadowRoot.querySelector('#button');
              expect(button).to.exist;
              MockInteractions.tap(button);
              setTimeout(function () {
                expect(el._boundedButtonClicked.calledOnce).to.be.true;
                expect(el.prop1).to.equal('changed');
                expect(el.shadowRoot.querySelector('#span').textContent.trim()).to.equal('changed')
                document.body.removeChild(el);
                done();
              });
            });

            test('button style is changed', function () {
              const el = document.createElement('test-element-three');
              document.body.append(el);
              const button = el.shadowRoot.querySelector('#button');
              expect(button).to.exist;
              expect(button.getBoundingClientRect().width).to.equal(500);
            });
          });
        }, 200);
      });
    </script>
  </body>
</html>